<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="favicon.png">
  <title>POS - Tashgheel</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      width: 300px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
      text-align: center;
    }

    .cart-item button {
      margin-left: 10px;
      padding: 4px 6px;
      font-size: 0.9em;
      cursor: pointer;
    }

    .timer-controls {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      margin-left: 5px;
    }

    .timer-btn {
      border: none;
      border-radius: 4px;
      padding: 2px 6px;
      cursor: pointer;
      font-size: 0.8em;
      color: white;
    }

    .timer-btn.start {
      background-color: #2ecc71;
    }

    .timer-btn.stop {
      background-color: #e74c3c;
    }

    .timer-display {
      font-family: monospace;
      font-weight: bold;
      font-size: 0.9em;
      color: #2c3e50;
    }
  </style>
</head>

<body>

  <!-- License Check -->
  <div id="licenseCheckOverlay"
    style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:#000000e6;z-index:10000;color:white;text-align:center;padding-top:150px;">
    <h2 data-i18n="access_denied">ğŸ”’ Access Denied</h2>
    <p data-i18n="license_required">This system requires a valid license to operate.</p>
    <button onclick="window.location.href='index.html'" class="btn btn-primary" style="margin-top: 20px;"
      data-i18n="go_activation">Go to
      Activation</button>
  </div>

  <!-- Language Switcher -->
  <div class="language-switcher">
    <button class="lang-btn" onclick="setLanguage('en')" id="langEn">English</button>
    <button class="lang-btn" onclick="setLanguage('ar')" id="langAr">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
  </div>

  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2 id="posSystemTitle" data-i18n="app_title">ğŸªTasgheel POS System</h2>
        <p id="licensedVersion" data-i18n="enhanced_edition">Enhanced Edition</p>
      </div>
      <nav>
        <a href="pos.html" class="nav-item active" data-i18n="nav_pos">ğŸ›’ Point of Sale</a>
        <a href="products.html" class="nav-item" data-i18n="nav_products">ğŸ“¦ Products</a>
        <a href="receipts.html" class="nav-item" data-i18n="nav_receipts">ğŸ§¾ Receipts</a>
        <a href="reports.html" class="nav-item" data-i18n="nav_reports">ğŸ“ˆ Reports</a>
        <a href="salesmen.html" class="nav-item" data-i18n="nav_salesmen">ğŸ§‘â€ğŸ’¼ Salesmen</a>
        <a href="expenses.html" class="nav-item" data-i18n="nav_expenses">ğŸ“‹ Expenses</a>

        <a href="admin.html" class="nav-item" data-i18n="nav_admin">âš™ï¸ Admin Panel</a>
        <a href="backup.html" class="nav-item" data-i18n="nav_backup">ğŸ’¾ BackUP</a>
      </nav>

      <div class="sidebar-footer">
        <button class="btn btn-danger" onclick="confirmLogout()" id="logoutBtn" data-i18n="logout">Logout</button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <header class="top-bar">
        <h1 id="pageTitle" data-i18n="pos_title">Point of Sale</h1>
        <div style="display:flex;align-items:center;gap:10px;">
          <span id="welcomeText" data-i18n="welcome">Welcome,</span>
          <span id="currentUserName">User</span>
          <span id="userRole" class="user-role">cashier</span>
          <span style="background:#27ae60;color:white;padding:4px 8px;border-radius:12px;font-size:0.7rem;"
            data-i18n="licensed">ğŸ”
            Licensed</span>
        </div>
      </header>

      <div id="readOnlyBanner"
        style="display:none; background:#e74c3c; color:white; padding:10px; text-align:center; font-weight:bold; margin-bottom:10px;">
        âš ï¸ Read-Only Mode: Shift opened by <span id="readOnlyUser"></span>. You cannot perform transactions.
      </div>

      <section class="content-area">
        <div class="pos-layout">
          <!-- Products Section -->
          <div>
            <div class="card">
              <!-- Categories Section -->
              <div id="categoryContainer"
                style="display:flex; gap:10px; overflow-x:auto; padding:10px; border-bottom:1px solid #eee; margin-bottom:10px; white-space:nowrap;">
                <button class="btn btn-primary category-btn active" onclick="filterProducts('all')" data-id="all"
                  data-i18n="all_categories">All</button>
                <!-- Categories will be loaded here -->
              </div>

              <div class="card-header" style="flex-direction: column; align-items: stretch; gap: 10px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <div class="tabs">
                    <button class="btn btn-primary" id="tabProducts" onclick="switchPosTab('products')">
                      <span data-i18n="products_title">Products</span>
                    </button>
                    <button class="btn btn-secondary" id="tabHeld" onclick="switchPosTab('held')">
                      <span data-i18n="held_orders">Held Orders</span>
                      <span id="heldCountBadge" class="badge"
                        style="background:red;font-size:0.7em;display:none">0</span>
                    </button>
                  </div>
                  <div style="display:flex;gap:10px;align-items:center;">
                    <input type="text" id="productSearch" placeholder="Search by name, code, or barcode..."
                      data-i18n="search_placeholder" class="search-box" style="width:200px;">
                    <button class="btn btn-secondary" onclick="scanBarcode()" id="scanBtn" data-i18n="scan_btn">ğŸ“·
                      Scan</button>
                  </div>
                </div>
              </div>
              <div class="card-body">
                <div class="product-grid" id="productGrid">
                  <div style="text-align:center;padding:40px;color:#666;">
                    <p id="loadingText" data-i18n="loading_products">Loading products...</p>
                  </div>
                </div>
                <div id="heldOrdersGrid" class="product-grid" style="display:none;">
                  <!-- Held items rendered here -->
                </div>
              </div>
            </div>
          </div>

          <!-- Cart Section -->
          <div class="cart">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
              <h3 id="cartTitle" data-i18n="cart_title">ğŸ›’ Cart</h3>
              <span id="cartCounter" class="badge">0</span>
            </div>

            <p id="cartEmptyText" style="text-align:center;color:#666;" data-i18n="cart_empty">Cart is empty</p>
            <div id="cartItems">
            </div>

            <div class="cart-summary">
              <div><span id="subtotalLabel" data-i18n="subtotal">Subtotal:</span> <span id="cartSubtotal">0.00
                  Ø¬.Ù…</span></div>
              <div><span id="discountLabel" data-i18n="discount">Discount:</span> <span id="cartDiscount">0.00
                  Ø¬.Ù…</span> <button onclick="openDiscountModal()" class="btn-sm"
                  style="font-size:0.8rem;padding:2px 5px;cursor:pointer;">âœï¸</button></div>
              <div>
                <input type="checkbox" id="taxCheckbox" onchange="updateCartSummary()">
                <span id="taxLabel" data-i18n="tax">Tax (0%):</span>
                <span id="cartTax">0.00 Ø¬.Ù…</span>
              </div>
              <hr>
              <div class="cart-total" id="cartTotal">Total: 0.00 Ø¬.Ù…</div>
            </div>

            <div style="margin-bottom:10px;">
              <label for="salesmanSelect">ğŸ‘¤ <span id="salesmanLabel" data-i18n="salesman">Salesman:</span></label>
              <select id="salesmanSelect" style="width:100%;padding:6px;margin-top:5px;"></select>
            </div>

            <div class="payment-methods">
              <button class="btn btn-success" onclick="processSale('cash')" id="cashBtn" disabled
                data-i18n="pay_cash">ğŸ’µ Cash</button>
              <button class="btn btn-success" onclick="processSale('card')" id="cardBtn" disabled
                data-i18n="pay_card">ğŸ’³ Card</button>
              <button class="btn btn-success" onclick="processSale('mobile')" id="mobileBtn" disabled
                data-i18n="pay_mobile">ğŸ“± Mobile</button>
              <button class="btn btn-primary" onclick="openSplitPaymentModal()" id="splitBtn" disabled
                data-i18n="pay_split">ğŸ”€ Split</button>
            </div>

            <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px;">
              <button class="btn btn-warning" onclick="holdTransaction()" id="holdBtn" disabled data-i18n="hold_btn">â¸ï¸
                Hold</button>
              <button class="btn btn-secondary" onclick="clearCart()" id="clearCartBtn" disabled
                data-i18n="clear_btn">ğŸ—‘ï¸ Clear</button>
            </div>

            <button class="btn btn-danger" onclick="closeShift()" style="margin-top:10px;width:100%;">ğŸ›‘ <span
                id="closeShiftBtn" data-i18n="close_shift">Close Shift</span></button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Open Shift Modal -->
  <div id="openShiftModal" class="modal" style="display:none; background:rgba(0,0,0,0.9);">
    <div class="modal-content" style="text-align:center;">
      <h2 data-i18n="open_shift">Open Shift</h2>
      <p data-i18n="enter_start_cash">Please enter the starting cash amount to begin.</p>
      <input type="number" id="startCashInput" placeholder="0.00"
        style="font-size:1.5em; padding:10px; width:150px; text-align:center; margin:20px 0;">
      <br>
      <button onclick="submitOpenShift()" class="btn btn-success btn-lg" data-i18n="start_shift">Start Shift</button>
    </div>
  </div>

  <!-- Resume Shift Modal -->
  <div id="resumeShiftModal" class="modal" style="display:none; background:rgba(0,0,0,0.9);">
    <div class="modal-content" style="text-align:center;">
      <h2 data-i18n="shift_detected">Open Shift Detected</h2>
      <p><span data-i18n="shift_started_at">Shift started at:</span> <span id="resumeShiftTime"></span></p>
      <div style="margin-top:20px; display:flex; gap:10px; justify-content:center;">
        <button onclick="resumeShift()" class="btn btn-primary" data-i18n="resume_shift">Resume Shift</button>
        <button onclick="closeShiftFromResume()" class="btn btn-danger" data-i18n="close_shift_now">Close Shift
          Now</button>
      </div>
    </div>
  </div>

  <!-- Locked Shift Modal -->
  <div id="lockedShiftModal" class="modal" style="display:none; background:rgba(0,0,0,0.9);">
    <div class="modal-content" style="text-align:center;">
      <h2 data-i18n="access_denied">Access Denied</h2>
      <p data-i18n="shift_open_by_other">Another user has an open shift.</p>
      <p style="font-weight:bold; font-size:1.2em; color:#e74c3c;" id="lockedShiftUser"></p>
      <p data-i18n="ask_close">Please ask them to close their shift first.</p>
      <br>
      <button onclick="window.location.href='index.html'" class="btn btn-secondary" data-i18n="logout">Logout</button>
    </div>
  </div>

  <!-- Close Shift Modal -->
  <div id="closeShiftModal" class="modal" style="display:none;">
    <div class="modal-content">
      <h3 data-i18n="close_shift">Close Shift</h3>
      <p data-i18n="confirm_close_shift">Are you sure you want to close your shift?</p>

      <div id="shiftSummaryDetails"
        style="text-align:left; margin-bottom:15px; padding:10px; background:#f9f9f9; border-radius:5px;">
        <p><span data-i18n="start_cash">Start Cash</span>: <span id="summaryStartCash">0.00</span></p>
        <p><span data-i18n="cash_sales">Cash Sales</span>: <span id="summaryCashSales">0.00</span></p>
        <p><span data-i18n="card_sales">Card Sales</span>: <span id="summaryCardSales">0.00</span></p>
        <p><span data-i18n="mobile_sales">Mobile Sales</span>: <span id="summaryMobileSales">0.00</span></p>
        <p><span data-i18n="returns">Returns</span>: <span id="summaryReturns">0.00</span></p>
        <p><span data-i18n="expenses">Expenses</span>: <span id="summaryExpenses">0.00</span></p>
        <hr>
        <p style="font-weight:bold;"><span data-i18n="expected_cash">Expected Cash</span>: <span
            id="summaryExpectedCash">0.00</span></p>
      </div>

      <div class="form-group">
        <label data-i18n="actual_cash">Actual Cash in Drawer:</label>
        <input type="number" id="actualCashInput" placeholder="0.00" required>
      </div>
      <div class="form-group" style="margin-top:10px;">
        <label data-i18n="actual_card">Actual Card Sales:</label>
        <input type="number" id="actualCardInput" placeholder="0.00">
      </div>
      <div class="form-group" style="margin-top:10px;">
        <label data-i18n="actual_mobile">Actual Mobile Sales:</label>
        <input type="number" id="actualMobileInput" placeholder="0.00">
      </div>

      <div class="modal-actions" style="margin-top:15px;">
        <button onclick="submitCloseShift()" class="btn btn-danger" data-i18n="close_shift">Close Shift</button>
        <button onclick="document.getElementById('closeShiftModal').style.display='none'" class="btn btn-secondary"
          data-i18n="cancel">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Close Day Modal -->
  <div id="closeDayModal" class="modal" style="display:none;">
    <div class="modal-content" style="width:400px;">
      <h3 id="daySummaryTitle" data-i18n="day_summary_title">ğŸ“Š Day Summary</h3>
      <div id="daySummaryContent" style="text-align:left;margin-top:10px;"></div>
      <br>
      <button onclick="window.print()" class="btn btn-primary">ğŸ–¨ï¸ <span id="printBtn"
          data-i18n="print">Print</span></button>
      <button onclick="document.getElementById('closeDayModal').style.display='none'" class="btn btn-danger">âœ–ï¸ <span
          id="cancelBtn" data-i18n="close">Close</span></button>
    </div>
  </div>

  <!-- Discount Modal -->
  <div id="discountModal" class="modal" style="display:none;">
    <div class="modal-content">
      <h3 id="discountTitle" data-i18n="discount_modal_title">ğŸ§¾ Discount</h3>
      <label data-i18n="discount_type">Discount Type:</label>
      <select id="discountType">
        <option value="none" data-i18n="discount_none">None</option>
        <option value="percent" data-i18n="discount_percent">Percentage (%)</option>
        <option value="value" data-i18n="discount_value">Fixed Value</option>
      </select>
      <br><br>
      <label data-i18n="discount_value_label">Value:</label>
      <input type="number" id="discountValue" placeholder="0">
      <br><br>
      <button onclick="saveDiscount()" data-i18n="discount_save">ğŸ’¾ Save</button>
      <button onclick="closeDiscountModal()" data-i18n="discount_cancel">âœ–ï¸ Cancel</button>
    </div>
  </div>

  <!-- Split Payment Modal -->
  <div id="splitPaymentModal" class="modal" style="display:none;">
    <div class="modal-content" style="width: 350px;">
      <h3 data-i18n="split_payment_title">Split Payment</h3>
      <h4 style="margin:10px 0;"><span data-i18n="total_to_pay">Total:</span> <span id="splitTotalAmount">0.00</span>
      </h4>

      <div style="display:grid; grid-template-columns: 80px 1fr; gap:10px; text-align:left; margin-bottom:15px;">
        <label>ğŸ’µ Cash</label>
        <input type="number" id="splitCash" class="split-input" placeholder="0" oninput="updateSplitCalculations()">

        <label>ğŸ’³ Card</label>
        <input type="number" id="splitCard" class="split-input" placeholder="0" oninput="updateSplitCalculations()">

        <label>ğŸ“± Mobile</label>
        <input type="number" id="splitMobile" class="split-input" placeholder="0" oninput="updateSplitCalculations()">
      </div>

      <p style="font-weight:bold; color:red; margin-bottom:15px;">
        <span data-i18n="remaining_amount">Remaining:</span> <span id="splitRemaining">0.00</span>
      </p>

      <button onclick="confirmSplitPayment()" id="confirmSplitBtn" class="btn btn-success" disabled
        data-i18n="confirm_payment">Check</button>
      <button onclick="document.getElementById('splitPaymentModal').style.display='none'" class="btn btn-secondary"
        data-i18n="cancel">Cancel</button>
    </div>
  </div>

  <!-- Footer -->
  <!-- Scripts -->
  <script src="js/auth.js"></script>
  <script src="js/translations.js"></script>
  <script src="js/pos-app.js"></script>
</body>

</html>